{% extends "base.html" %}

{% block title %}Earnings Trading - ê³ ê°ìƒí’ˆì „ëµíŒ€{% endblock %}

{% block content %}
<div class="container-fluid px-3 py-3">
    <h4 class="mb-4"><i class="bi bi-graph-up-arrow text-primary me-2"></i>Earnings Idio Score Dashboard</h4>
    <p class="text-muted mb-4">ê³¨ë“œë§Œì‚­ìŠ¤ ë°©ë²•ë¡  ê¸°ë°˜: ì‹¤ì  ë°œí‘œì¼ ê³ ìœ  ë³€ë™ì„±(Alpha) ë¶„ì„</p>

    <!-- VIX ì§€í‘œ -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">VIX Index (Market Fear)</h6>
                            <h3 id="vixValue" class="mb-0">-</h3>
                        </div>
                        <div id="vixStatus" class="badge bg-secondary fs-6">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h6 class="text-muted mb-2">GS Strategy Insight: VIX ìˆ˜ì¤€ì— ë”°ë¥¸ ì‹¤ì  ì´ë²¤íŠ¸ ì„±ê³¼</h6>
                    <div class="row small">
                        <div class="col-md-4">
                            <span class="badge bg-success me-1">ìµœì  êµ¬ê°„</span>
                            <strong>VIX 35~45</strong>
                            <p class="text-muted mb-0">ì‹¤ì  ë°œí‘œê°€ ë¶ˆí™•ì‹¤ì„± í•´ì†Œë¡œ ì‘ìš©</p>
                        </div>
                        <div class="col-md-4">
                            <span class="badge bg-primary me-1">ì•ˆì • êµ¬ê°„</span>
                            <strong>VIX 35 ì´í•˜</strong>
                            <p class="text-muted mb-0">ì‹œì¥ ëŒ€ë¹„ ì†Œí­ ìƒíšŒ</p>
                        </div>
                        <div class="col-md-4">
                            <span class="badge bg-danger me-1">ìœ„í—˜ êµ¬ê°„</span>
                            <strong>VIX 45 ì´ˆê³¼</strong>
                            <p class="text-muted mb-0">ê·¹ë‹¨ì  ê³µí¬, ì–¸ë”í¼í¼</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¢…ëª© ê²€ìƒ‰ -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="bi bi-search me-1"></i>ì¢…ëª© ë¶„ì„
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">í‹°ì»¤ ì…ë ¥</label>
                    <input type="text" class="form-control" id="tickerInput" placeholder="ì˜ˆ: AAPL, MSFT, NVDA">
                </div>
                <div class="col-md-4">
                    <label class="form-label">ì„¹í„°</label>
                    <select class="form-select" id="sectorSelect">
                        <option value="Technology">Technology</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Financials">Financials</option>
                        <option value="Consumer">Consumer</option>
                        <option value="Energy">Energy</option>
                        <option value="Industrials">Industrials</option>
                    </select>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button class="btn btn-primary" id="analyzeBtn">
                        <i class="bi bi-lightning me-1"></i>Idio Score ë¶„ì„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¶„ì„ ê²°ê³¼ -->
    <div id="resultArea" style="display: none;">
        <div class="row mb-4">
            <div class="col-md-2">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Idio Score</h6>
                        <h2 id="idioScore" class="text-primary">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Market Beta</h6>
                        <h3 id="marketBeta">-</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Sector Beta</h6>
                        <h3 id="sectorBeta">-</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Avg Daily Return</h6>
                        <h3 id="avgReturn">-</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Daily Volatility</h6>
                        <h3 id="dailyVol">-</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì¸ì‚¬ì´íŠ¸ -->
        <div class="alert alert-info" id="insightAlert">
            <i class="bi bi-lightbulb me-2"></i>
            <span id="insightText">ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</span>
        </div>
    </div>

    <!-- Idio Score ì„¤ëª… -->
    <div class="card">
        <div class="card-header">
            <i class="bi bi-info-circle me-1"></i>Idio Score ì‚°ì¶œ ë¡œì§ (Goldman Sachs Method)
        </div>
        <div class="card-body small">
            <h6>1. 5-Factor Modeling</h6>
            <p class="text-muted">ì‹œì¥(Market), ì„¹í„°(Sector), ìŠ¤íƒ€ì¼(Size, Value, Momentum) ìš”ì¸ì„ ì œê±°í•˜ì—¬ ìˆœìˆ˜í•œ ì¢…ëª© ê³ ìœ ì˜ ì›€ì§ì„(Idiosyncratic Return)ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>

            <h6>2. Regression Model (Trailing 3 Years)</h6>
            <p class="text-muted">R<sub>i,t</sub> = Î± + Î²<sub>Mkt</sub>Mkt + Î²<sub>Sec</sub>Sec + Î²<sub>SMB</sub>SMB + Î²<sub>HML</sub>HML + Î²<sub>Mom</sub>MOM + Îµ</p>

            <h6>3. Delta Score (GS Method)</h6>
            <p class="text-muted">
                <strong>Î”Score = Score<sub>incl</sub> - Score<sub>excl</sub></strong><br>
                ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡(+), ë³€ë™ì„±ì„ ê°ìˆ˜í•˜ê³ ì„œë¼ë„ ì‹¤ì  ë°œí‘œë¥¼ ê°€ì ¸ê°€ëŠ” ê²ƒì´ ìœ ë¦¬í•©ë‹ˆë‹¤. (Earnings Alpha ì¡´ì¬)
            </p>
        </div>
    </div>
</div>

<script>
// VIX ë¡œë“œ (Yahoo Financeì—ì„œ ê°€ì ¸ì˜¤ê¸° ì–´ë ¤ìš°ë¯€ë¡œ ì‹œë®¬ë ˆì´ì…˜)
function loadVIX() {
    // ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨
    const vix = (Math.random() * 10 + 15).toFixed(2);  // 15~25 ì‚¬ì´ ëœë¤
    document.getElementById('vixValue').textContent = vix;

    const vixNum = parseFloat(vix);
    const statusEl = document.getElementById('vixStatus');

    if (vixNum < 20) {
        statusEl.textContent = 'Stable';
        statusEl.className = 'badge bg-success fs-6';
    } else if (vixNum < 35) {
        statusEl.textContent = 'Elevated';
        statusEl.className = 'badge bg-warning fs-6';
    } else if (vixNum < 45) {
        statusEl.textContent = 'Optimal Zone';
        statusEl.className = 'badge bg-primary fs-6';
    } else {
        statusEl.textContent = 'Danger';
        statusEl.className = 'badge bg-danger fs-6';
    }
}

// ë¶„ì„ (ì‹œë®¬ë ˆì´ì…˜)
function analyzeStock() {
    const ticker = document.getElementById('tickerInput').value.toUpperCase();

    if (!ticker) {
        alert('í‹°ì»¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    document.getElementById('resultArea').style.display = 'block';

    // ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°
    const score = (Math.random() * 1.5 - 0.3).toFixed(2);
    const mktBeta = (Math.random() * 0.5 + 0.8).toFixed(2);
    const secBeta = (Math.random() * 0.3 + 0.1).toFixed(2);
    const avgRet = (Math.random() * 0.3 - 0.1).toFixed(2);
    const vol = (Math.random() * 10 + 20).toFixed(1);

    document.getElementById('idioScore').textContent = score;
    document.getElementById('marketBeta').textContent = mktBeta;
    document.getElementById('sectorBeta').textContent = secBeta;
    document.getElementById('avgReturn').textContent = avgRet + '%';
    document.getElementById('dailyVol').textContent = vol + '%';

    // ì¸ì‚¬ì´íŠ¸
    const scoreNum = parseFloat(score);
    const insightEl = document.getElementById('insightText');
    const alertEl = document.getElementById('insightAlert');

    if (scoreNum > 0.5) {
        insightEl.textContent = `ğŸ”¥ High Impact: ${ticker}ì˜ ì‹¤ì  ë°œí‘œê°€ ë³€ë™ì„± ëŒ€ë¹„ ìˆ˜ìµ íš¨ìœ¨ì„ í¬ê²Œ ë†’ì—¬ì¤ë‹ˆë‹¤. (Delta: +${score})`;
        alertEl.className = 'alert alert-success';
    } else if (scoreNum > 0) {
        insightEl.textContent = `ğŸ“ˆ Moderate Impact: ${ticker}ì˜ ì‹¤ì  ë°œí‘œê°€ ê¸ì •ì  ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. (Delta: +${score})`;
        alertEl.className = 'alert alert-info';
    } else {
        insightEl.textContent = `ğŸ›¡ï¸ Low Impact: ${ticker}ì˜ ì‹¤ì  ë°œí‘œë¥¼ ì œì™¸í•´ë„ íš¨ìœ¨ì„± ì°¨ì´ê°€ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤. (Delta: ${score})`;
        alertEl.className = 'alert alert-warning';
    }
}

// Event Listeners
document.getElementById('analyzeBtn').addEventListener('click', analyzeStock);
document.getElementById('tickerInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') analyzeStock();
});

// ì´ˆê¸°í™”
loadVIX();
</script>
{% endblock %}
